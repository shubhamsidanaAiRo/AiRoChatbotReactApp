(function(e,t){"function"==typeof define&&define.amd?define(function(){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(e):e.ss=t(e)})("undefined"!=typeof window?window:this,function(e){var t,s=e.ss||{},n=/^\s+/,i=/\s+$/,o=/[xy]/g,r=/.*(\/|\\)/,a=/.*[.]/,l=/[\t\r\n]/g,u=Object.prototype.toString.call(e.HTMLElement).indexOf("Constructor")>0,d=-1!==navigator.userAgent.indexOf("MSIE 7"),c=document.createElement("input");c.type="file",t="multiple"in c&&"undefined"!=typeof File&&void 0!==(new XMLHttpRequest).upload,s.obj2string=function(e,t){"use strict";var n=[];for(var i in e)if(e.hasOwnProperty(i)){var o=t?t+"["+i+"]":i,r=e[i];n.push("object"==typeof r?s.obj2string(r,o):encodeURIComponent(o)+"="+encodeURIComponent(r))}return n.join("&")},s.extendObj=function(e,t){"use strict";for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])},s.addEvent=function(e,t,n){"use strict";return e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n),function(){s.removeEvent(e,t,n)}},s.removeEvent=document.removeEventListener?function(e,t,s){e.removeEventListener&&e.removeEventListener(t,s,!1)}:function(e,t,s){var n="on"+t;void 0===e[n]&&(e[n]=null),e.detachEvent(n,s)},s.newXHR=function(){"use strict";if("undefined"!=typeof XMLHttpRequest)return new e.XMLHttpRequest;if(e.ActiveXObject)try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return!1}},s.encodeUTF8=function(e){"use strict";return unescape(encodeURIComponent(e))},s.getIFrame=function(){"use strict";var e,t=s.getUID();return d?e=document.createElement('<iframe src="javascript:false;" name="'+t+'">'):(e=document.createElement("iframe"),e.src="javascript:false;",e.name=t),e.style.display="none",e.id=t,e},s.getForm=function(e){"use strict";var t=document.createElement("form");for(var s in t.encoding="multipart/form-data",t.enctype="multipart/form-data",t.style.display="none",e)e.hasOwnProperty(s)&&(t[s]=e[s]);return t},s.getHidden=function(e,t){"use strict";var s=document.createElement("input");return s.type="hidden",s.name=e,s.value=t,s},s.parseJSON=function(t){"use strict";if(!t)return!1;if(t=s.trim(t+""),e.JSON&&e.JSON.parse)try{return e.JSON.parse(t+"")}catch(e){return!1}var n,i=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g,o=null;return!(!t||s.trim(t.replace(i,function(e,t,s,i){return n&&t&&(o=0),0===o?e:(n=s||t,o+=!i-!s,"")})))&&Function("return "+t)()},s.getBox=function(t){"use strict";var s,n,i=0,o=0;if(t.getBoundingClientRect)s=t.getBoundingClientRect(),n=document.documentElement,i=s.top+(e.pageYOffset||n.scrollTop)-(n.clientTop||0),o=s.left+(e.pageXOffset||n.scrollLeft)-(n.clientLeft||0);else do{o+=t.offsetLeft,i+=t.offsetTop}while(t=t.offsetParent);return{top:Math.round(i),left:Math.round(o)}},s.addStyles=function(e,t){"use strict";for(var s in t)t.hasOwnProperty(s)&&(e.style[s]=t[s])},s.copyLayout=function(e,t){"use strict";s.getBox(e);s.addStyles(t,{position:"absolute",width:e.offsetWidth+"px",height:e.offsetHeight+"px"})},s.getUID=function(){"use strict";return"axxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(o,function(e){var t=16*Math.random()|0,s="x"==e?t:3&t|8;return s.toString(16)})};var p="".trim;s.trim=p&&!p.call("\ufeffÂ ")?function(e){return null===e?"":p.call(e)}:function(e){return null===e?"":e.toString().replace(n,"").replace(i,"")};var f=[];return s.indexOf=f.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var s=0,n=e.length;s<n;s++)if(e[s]===t)return s;return-1},s.arrayDelete=function(e,t){var n=s.indexOf(e,t);n>-1&&e.splice(n,1)},s.getFilename=function(e){"use strict";return e.replace(r,"")},s.getExt=function(e){"use strict";return-1!==e.indexOf(".")?e.replace(a,""):""},s.isVisible=function(e){"use strict";return!!e&&(1!==e.nodeType||e==document.body?(e=null,!0):e.parentNode&&(e.offsetWidth>0||e.offsetHeight>0||"none"!=s.getStyle(e,"display").toLowerCase())?s.isVisible(e.parentNode):(e=null,!1))},s.getStyle=function(t,s){"use strict";if(e.getComputedStyle){var n=t.ownerDocument.defaultView.getComputedStyle(t,null);return n.getPropertyValue(s)}if(t.currentStyle&&t.currentStyle[s])return t.currentStyle[s]},s.getFormObj=function(e){"use strict";for(var t,n=e.elements,i=["button","submit","image","reset"],o={},r=0,a=n.length;r<a;r++)if(t={},n[r].name&&!n[r].disabled&&-1===s.indexOf(i,n[r].type)){if(("checkbox"==n[r].type||"radio"==n[r].type)&&!n[r].checked)continue;t[n[r].name]=s.val(n[r]),s.extendObj(o,t)}return o},s.val=function(e){"use strict";if(e){if("SELECT"==e.nodeName.toUpperCase()){for(var t,s=e.options,n=e.selectedIndex,i="select-one"===e.type||n<0,o=i?null:[],r=0,a=s.length;r<a;r++)if((s[r].selected||r===n)&&!s[r].disabled){if(t=s[r].value?s[r].value:s[r].text,i)return t;o.push(t)}return o}return e.value}},s.hasClass=function(e,t){"use strict";return!(!e||!t)&&(" "+e.className+" ").replace(l," ").indexOf(" "+t+" ")>=0},s.addClass=function(e,t){"use strict";if(!e||!t)return!1;s.hasClass(e,t)||(e.className+=" "+t)},s.removeClass=function(){"use strict";var e={};return function(t,s){if(!t||!s)return!1;e[s]||(e[s]=new RegExp("(?:^|\\s)"+s+"(?!\\S)")),t.className=t.className.replace(e[s],"")}}(),s.purge=function(e){"use strict";var t,n,i,o=e.attributes;if(o)for(t=o.length-1;t>=0;t-=1)i=o[t].name,"function"==typeof e[i]&&(e[i]=null);if(o=e.childNodes,o)for(n=o.length,t=0;t<n;t+=1)s.purge(e.childNodes[t])},s.remove=function(e){"use strict";e&&e.parentNode&&(s.purge(e),e.parentNode.removeChild(e)),e=null},s.verifyElem=function(t){"use strict";return"undefined"!=typeof jQuery&&t instanceof jQuery?t=t[0]:"string"==typeof t&&("#"==t.charAt(0)&&(t=t.substr(1)),t=document.getElementById(t)),!(!t||1!==t.nodeType)&&("A"==t.nodeName.toUpperCase()&&(t.style.cursor="pointer",s.addEvent(t,"click",function(t){t&&t.preventDefault?t.preventDefault():e.event&&(e.event.returnValue=!1)})),t)},s._options={},s.uploadSetup=function(e){"use strict";s.extendObj(s._options,e)},s.SimpleUpload=function(e){"use strict";if(this._opts={button:"",url:"",dropzone:"",dragClass:"",form:"",overrideSubmit:!0,cors:!1,withCredentials:!1,progressUrl:!1,sessionProgressUrl:!1,nginxProgressUrl:!1,multiple:!1,capture:!1,maxUploads:3,queue:!0,checkProgressInterval:500,keyParamName:"APC_UPLOAD_PROGRESS",sessionProgressName:"PHP_SESSION_UPLOAD_PROGRESS",nginxProgressHeader:"X-Progress-ID",customProgressHeaders:{},corsInputName:"XHR_CORS_TARGETORIGIN",allowedExtensions:[],accept:"",maxSize:!1,name:"",data:{},noParams:!0,autoSubmit:!0,multipart:!0,method:"POST",responseType:"",debug:!1,hoverClass:"",focusClass:"",disabledClass:"",customHeaders:{},encodeHeaders:!0,autoCalibrate:!0,onBlankSubmit:function(){},onAbort:function(e,t,s){},onChange:function(e,t,s,n,i){},onSubmit:function(e,t,s,n){},onProgress:function(e){},onUpdateFileSize:function(e){},onComplete:function(e,t,s,n){},onExtError:function(e,t){},onSizeError:function(e,t){},onError:function(e,t,s,n,i,o,r){},startXHR:function(e,t,s){},endXHR:function(e,t,s){},startNonXHR:function(e,t){},endNonXHR:function(e,t){}},s.extendObj(this._opts,s._options),s.extendObj(this._opts,e),this._queue=[],this._active=0,this._disabled=!1,this._maxFails=10,this._progKeys={},this._sizeFlags={},this._btns=[],this.addButton(this._opts.button),delete this._opts.button,this._opts.button=e=null,!1===this._opts.multiple&&(this._opts.maxUploads=1),""!==this._opts.dropzone&&this.addDZ(this._opts.dropzone),""===this._opts.dropzone&&this._btns.length<1)throw new Error("Invalid upload button. Make sure the element you're passing exists.");""!==this._opts.form&&this.setForm(this._opts.form),this._createInput(),this._manDisabled=!1,this.enable(!0)},s.SimpleUpload.prototype={destroy:function(){"use strict";for(var e=this._btns.length;e--;)this._btns[e].off&&this._btns[e].off(),s.removeClass(this._btns[e],this._opts.hoverClass),s.removeClass(this._btns[e],this._opts.focusClass),s.removeClass(this._btns[e],this._opts.disabledClass),this._btns[e].disabled=!1;this._killInput(),this._destroy=!0},log:function(t){"use strict";this._opts&&this._opts.debug&&e.console&&e.console.log&&e.console.log("[Uploader] "+t)},setData:function(e){"use strict";this._opts.data=e},setOptions:function(e){"use strict";s.extendObj(this._opts,e)},addButton:function(e){var t;if(e instanceof Array)for(var n=0,i=e.length;n<i;n++)t=s.verifyElem(e[n]),!1!==t?this._btns.push(this.rerouteClicks(t)):this.log("Button with array index "+n+" is invalid");else t=s.verifyElem(e),!1!==t&&this._btns.push(this.rerouteClicks(t))},addDZ:function(e){t&&(e=s.verifyElem(e),e?this.addDropZone(e):this.log("Invalid or nonexistent element passed for drop zone"))},setProgressBar:function(e){"use strict";this._progBar=s.verifyElem(e)},setPctBox:function(e){"use strict";this._pctBox=s.verifyElem(e)},setFileSizeBox:function(e){"use strict";this._sizeBox=s.verifyElem(e)},setProgressContainer:function(e){"use strict";this._progBox=s.verifyElem(e)},setAbortBtn:function(e,t){"use strict";this._abortBtn=s.verifyElem(e),this._removeAbort=!1,t&&(this._removeAbort=!0)},setForm:function(t){"use strict";if(this._form=s.verifyElem(t),this._form&&"FORM"==this._form.nodeName.toUpperCase()){var n=this;this._opts.autoSubmit=!1,this._opts.overrideSubmit&&(s.addEvent(this._form,"submit",function(t){t.preventDefault?t.preventDefault():e.event&&(e.event.returnValue=!1),n._validateForm()&&n.submit()}),this._form.submit=function(){n._validateForm()&&n.submit()})}else this.log("Invalid or nonexistent element passed for form")},getQueueSize:function(){"use strict";return this._queue.length},removeCurrent:function(e){"use strict";if(e){for(var t=this._queue.length;t--;)if(this._queue[t].id===e){this._queue.splice(t,1);break}}else this._queue.splice(0,1);this._cycleQueue()},clearQueue:function(){"use strict";this._queue.length=0},disable:function(e){"use strict";var t,n=this._btns.length;for(this._manDisabled=!e||!0===this._manDisabled,this._disabled=!0;n--;)t=this._btns[n].nodeName.toUpperCase(),"INPUT"!=t&&"BUTTON"!=t||(this._btns[n].disabled=!0),""!==this._opts.disabledClass&&s.addClass(this._btns[n],this._opts.disabledClass);this._input&&this._input.parentNode&&(this._input.parentNode.style.visibility="hidden")},enable:function(e){"use strict";if(e||(this._manDisabled=!1),!0!==this._manDisabled){var t=this._btns.length;for(this._disabled=!1;t--;)s.removeClass(this._btns[t],this._opts.disabledClass),this._btns[t].disabled=!1}},updatePosition:function(e){"use strict";e=e||this._btns[0],e&&this._input&&this._input.parentNode&&s.copyLayout(e,this._input.parentNode),e=null},rerouteClicks:function(t){"use strict";var n=this;if(t.off=s.addEvent(t,"mouseover",function(){n._disabled||(n._input||n._createInput(),n._overBtn=t,s.copyLayout(t,n._input.parentNode),n._input.parentNode.style.visibility="visible")}),n._opts.autoCalibrate&&!s.isVisible(t)){n.log("Upload button not visible");var i=function(){s.isVisible(t)?(n.log("Upload button now visible"),e.setTimeout(function(){n.updatePosition(t),1===n._btns.length&&(n._input.parentNode.style.visibility="hidden")},200)):e.setTimeout(i,500)};e.setTimeout(i,500)}return t},submit:function(e,t){"use strict";!t&&this._queue.length<1?this._opts.onBlankSubmit.call(this):this._disabled||this._active>=this._opts.maxUploads||this._queue.length<1||this._checkFile(this._queue[0])&&(!1!==this._opts.onSubmit.call(this,this._queue[0].name,this._queue[0].ext,this._queue[0].btn,this._queue[0].size)?(this._active++,(!1===this._opts.multiple||!1===this._opts.queue&&this._active>=this._opts.maxUploads)&&this.disable(!0),this._initUpload(this._queue[0])):this.removeCurrent(this._queue[0].id))}},s.IframeUpload={_detachEvents:{},_detach:function(e){this._detachEvents[e]&&(this._detachEvents[e](),delete this._detachEvents[e])},_getHost:function(e){var t=document.createElement("a");return t.href=e,t.hostname?t.hostname.toLowerCase():e},_addFiles:function(e){var t=s.getFilename(e.value),n=s.getExt(t);return!1!==this._opts.onChange.call(this,t,n,this._overBtn,void 0,e)&&(this._queue.push({id:s.getUID(),file:e,name:t,ext:n,btn:this._overBtn,size:null}),!0)},_uploadIframe:function(t,n,i,o,r,a,l){"use strict";var u,d,c,p=this,f=this._opts,h=s.getUID(),m=s.getIFrame(),_=!1,g=!1;if(d=!0===f.noParams?f.url:f.nginxProgressUrl?d+(d.indexOf("?")>-1?"&":"?")+encodeURIComponent(f.nginxProgressHeader)+"="+encodeURIComponent(h):f.url,u=s.getForm({action:d,target:m.name,method:f.method}),f.onProgress.call(this,0),r&&(r.innerHTML="0%"),o&&(o.style.width="0%"),f.cors){var v=s.getUID();p._detachEvents[v]=s.addEvent(e,"message",function(e){p._getHost(e.origin)==p._getHost(f.url)?(_=!0,p._detach(v),f.endNonXHR.call(p,t.name,t.btn),p._finish(t,"","",e.data,i,n,r,a,l)):p.log("Non-matching origin: "+e.origin)})}p._detachEvents[m.id]=s.addEvent(m,label,function(){for(var d in p._detach(m.id),f.sessionProgressUrl?u.appendChild(s.getHidden(f.sessionProgressName,h)):f.progressUrl&&u.appendChild(s.getHidden(f.keyParamName,h)),p._form&&s.extendObj(f.data,s.getFormObj(p._form)),f.data)f.data.hasOwnProperty(d)&&u.appendChild(s.getHidden(d,f.data[d]));f.cors&&u.appendChild(s.getHidden(f.corsInputName,e.location.href)),u.appendChild(t.file),p._detachEvents[t.id]=s.addEvent(m,label,function(){if(m&&m.parentNode&&!g)if(p._detach(t.id),g=!0,delete p._progKeys[h],delete p._sizeFlags[h],a&&s.removeEvent(a,"click",c),f.cors)e.setTimeout(function(){s.remove(m),_||p._errorFinish(t,"","",!1,"error",n,i,r,a,l),t=f=h=m=i=n=r=a=l=null},600);else{try{var o=m.contentDocument?m.contentDocument:m.contentWindow.document,u=o.body.innerHTML;s.remove(m),m=null,f.endNonXHR.call(p,t.name,t.btn),p._finish(t,"","",u,i,n,r,a,l)}catch(e){p._errorFinish(t,"",e.message,!1,"error",n,i,r,a,l)}t=f=h=i=n=r=null}}),a&&(c=function(){if(s.removeEvent(a,"click",c),delete p._progKeys[h],delete p._sizeFlags[h],m){g=!0,p._detach(t.id);try{m.contentWindow.document.execCommand&&m.contentWindow.document.execCommand("Stop")}catch(e){}try{m.src="javascript".concat(":false;")}catch(e){}e.setTimeout(function(){s.remove(m),m=null},1)}p.log("Upload aborted"),f.onAbort.call(p,t.name,t.btn,t.size),p._last(i,n,r,a,l)},s.addEvent(a,"click",c)),p.log("Commencing upload using iframe"),u.submit(),e.setTimeout(function(){s.remove(u),u=null,p.removeCurrent(t.id)},1),p._hasProgUrl&&(p._progKeys[h]=1,e.setTimeout(function(){p._getProg(h,o,i,r,1),o=i=r=null},600))}),document.body.appendChild(u),document.body.appendChild(m)},_getProg:function(t,n,i,o,r){"use strict";var a,l,u,d=this,c=this._opts,p=(new Date).getTime();if(t)if(c.nginxProgressUrl?l=c.nginxProgressUrl+"?"+encodeURIComponent(c.nginxProgressHeader)+"="+encodeURIComponent(t)+"&_="+p:c.sessionProgressUrl?l=c.sessionProgressUrl:c.progressUrl&&(l=c.progressUrl+"?progresskey="+encodeURIComponent(t)+"&_="+p),u=function(){var l,p,f,h,m;try{if(u&&(c.cors||4===a.readyState)){u=void 0,a.onreadystatechange=function(){};try{m=a.statusText,h=a.status}catch(e){m="",h=""}if(c.cors||h>=200&&h<300){if(l=s.parseJSON(a.responseText),!1===l)return void d.log("Error parsing progress response (expecting JSON)");if(c.nginxProgressUrl){if("uploading"==l.state)p=parseInt(l.size,10),p>0&&(f=Math.round(parseInt(l.received,10)/p*100),p=Math.round(p/1024));else if("done"==l.state)f=100;else if("error"==l.state)return void d.log("Error requesting upload progress: "+l.status)}else(c.sessionProgressUrl||c.progressUrl)&&!0===l.success&&(p=parseInt(l.size,10),f=parseInt(l.pct,10));if(f&&(o&&(o.innerHTML=f+"%"),n&&(n.style.width=f+"%"),c.onProgress.call(d,f)),p&&!d._sizeFlags[t]&&(i&&(i.innerHTML=p+"K"),d._sizeFlags[t]=1,c.onUpdateFileSize.call(d,p)),!f&&!p&&r>=d._maxFails)return r++,void d.log("Failed progress request limit reached. Count: "+r);f<100&&d._progKeys[t]&&e.setTimeout(function(){d._getProg(t,n,i,o,r),t=n=i=o=r=null},c.checkProgressInterval)}else delete d._progKeys[t],d.log("Error requesting upload progress: "+h+" "+m);a=p=f=h=m=l=null}}catch(e){d.log("Error requesting upload progress: "+e.message)}},c.cors&&!c.sessionProgressUrl){if(!e.XDomainRequest)return;a=new e.XDomainRequest,a.open("GET",l,!0),a.onprogress=a.ontimeout=function(){},a.onload=u,a.onerror=function(){delete d._progKeys[t],t=null,d.log("Error requesting upload progress")}}else{var f,h=c.sessionProgressUrl?"POST":"GET",m={};for(var _ in a=s.newXHR(),a.onreadystatechange=u,a.open(h,l,!0),c.sessionProgressUrl&&(f=encodeURIComponent(c.sessionProgressName)+"="+encodeURIComponent(t),m["Content-Type"]="application/x-www-form-urlencoded"),c.nginxProgressUrl&&(m[c.nginxProgressHeader]=t),m["X-Requested-With"]="XMLHttpRequest",m.Accept="application/json, text/javascript, */*; q=0.01",s.extendObj(m,c.customProgressHeaders),m)m.hasOwnProperty(_)&&(c.encodeHeaders?a.setRequestHeader(_,s.encodeUTF8(m[_]+"")):a.setRequestHeader(_,m[_]+""));a.send(c.sessionProgressUrl&&f||null)}},_initUpload:function(e){if(!1===this._opts.startNonXHR.call(this,e.name,e.btn))return this._disabled&&this.enable(!0),void this._active--;this._hasProgUrl=!!(this._opts.progressUrl||this._opts.sessionProgressUrl||this._opts.nginxProgressUrl),this._uploadIframe(e,this._progBox,this._sizeBox,this._progBar,this._pctBox,this._abortBtn,this._removeAbort),e=this._progBox=this._sizeBox=this._progBar=this._pctBox=this._abortBtn=this._removeAbort=null}},s.XhrUpload={_addFiles:function(e){var t,n,i,o,r=e.length;for(this._opts.multiple||(r=1),o=0;o<r;o++){if(t=s.getFilename(e[o].name),n=s.getExt(t),i=Math.round(e[o].size/1024),!1===this._opts.onChange.call(this,t,n,this._overBtn,i,e[o]))return!1;this._queue.push({id:s.getUID(),file:e[o],name:t,ext:n,btn:this._overBtn,size:i})}return!0},_uploadXhr:function(e,t,n,i,o,r,a,l,u,d){"use strict";var c,p,f=this,h=this._opts,m=s.newXHR();for(var _ in o&&(o.innerHTML=e.size+"K"),l&&(l.innerHTML="0%"),r&&(r.style.width="0%"),c=function(t,n){var i;try{if(c&&(n||4===m.readyState))if(c=void 0,m.onreadystatechange=function(){},n)4!==m.readyState&&m.abort(),h.onAbort.call(f,e.name,e.btn,e.size),f._last(o,a,l,u,d);else{u&&s.removeEvent(u,"click",p);try{i=m.statusText}catch(e){i=""}m.status>=200&&m.status<300?(h.endXHR.call(f,e.name,e.size,e.btn),f._finish(e,m.status,i,m.responseText,o,a,l,u,d)):f._errorFinish(e,m.status,i,m.responseText,"error",a,o,l,u,d)}}catch(t){n||f._errorFinish(e,-1,t.message,!1,"error",a,o,l,u,d)}},u&&(p=function(){s.removeEvent(u,"click",p),c&&c(void 0,!0)},s.addEvent(u,"click",p)),m.onreadystatechange=c,m.open(h.method.toUpperCase(),t,!0),m.withCredentials=!!h.withCredentials,s.extendObj(i,h.customHeaders),i)i.hasOwnProperty(_)&&(h.encodeHeaders?m.setRequestHeader(_,s.encodeUTF8(i[_]+"")):m.setRequestHeader(_,i[_]+""));if(s.addEvent(m.upload,"progress",function(e){if(e.lengthComputable){var t=Math.round(e.loaded/e.total*100);h.onProgress.call(f,t),l&&(l.innerHTML=t+"%"),r&&(r.style.width=t+"%")}}),h.onProgress.call(this,0),!0===h.multipart){var g=new FormData,v=!1;for(var y in n)n.hasOwnProperty(y)&&(y!==h.name||!0!==h.noParams||f._form||(v=!0),g.append(y,n[y]));v||g.append(h.name,e.file),this.log("Commencing upload using multipart form"),m.send(g)}else this.log("Commencing upload using binary stream"),m.send(e.file);this.removeCurrent(e.id)},_initUpload:function(e){"use strict";var t,n={},i={};if(!1===this._opts.startXHR.call(this,e.name,e.size,e.btn))return this._disabled&&this.enable(!0),void this._active--;i["X-Requested-With"]="XMLHttpRequest",i["X-File-Name"]=e.name,"json"==this._opts.responseType.toLowerCase()&&(i.Accept="application/json, text/javascript, */*; q=0.01"),this._opts.multipart||(i["Content-Type"]="application/octet-stream"),this._form&&s.extendObj(n,s.getFormObj(this._form)),s.extendObj(n,this._opts.data),t=!0===this._opts.noParams?this._opts.url:this._opts.url+(this._opts.url.indexOf("?")>-1?"&":"?")+s.obj2string(n),this._uploadXhr(e,t,n,i,this._sizeBox,this._progBar,this._progBox,this._pctBox,this._abortBtn,this._removeAbort),this._sizeBox=this._progBar=this._progBox=this._pctBox=this._abortBtn=this._removeAbort=null}},s.DragAndDrop={_dragFileCheck:function(e){if(e.dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"==e.dataTransfer.types[t])return!0;return!1},addDropZone:function(e){var t=this,n=[];s.addStyles(e,{zIndex:16777271,position:"relative"}),e.ondragenter=function(e){return e.stopPropagation(),e.preventDefault(),!!t._dragFileCheck(e)&&(0===n.length&&s.addClass(this,t._opts.dragClass),-1===s.indexOf(n,e.target)&&n.push(e.target),!1)},e.ondragover=function(e){return e.stopPropagation(),e.preventDefault(),t._dragFileCheck(e)&&(e.dataTransfer.dropEffect="copy"),!1},e.ondragend=function(){return s.removeClass(this,t._opts.dragClass),!1},e.ondragleave=function(e){return s.arrayDelete(n,e.target),0===n.length&&s.removeClass(this,t._opts.dragClass),!1},e.ondrop=function(e){e.stopPropagation(),e.preventDefault(),s.arrayDelete(n,e.target),0===n.length&&s.removeClass(this,t._opts.dragClass),t._dragFileCheck(e)&&!1!==t._addFiles(e.dataTransfer.files)&&t._cycleQueue()}}},s.extendObj(s.SimpleUpload.prototype,{_createInput:function(){"use strict";var e=this,n=document.createElement("div");this._input=document.createElement("input"),this._input.type="file",this._input.name=this._opts.name,t&&!u&&this._opts.multiple&&(this._input.multiple=!0),"accept"in this._input&&""!==this._opts.accept&&(this._input.accept=this._opts.accept),this._opts.capture&&(this._input.capture=!0),s.addStyles(n,{display:"block",position:"absolute",overflow:"hidden",cursor:"pointer",margin:0,top:0,left:0,padding:0,opacity:0,direction:"ltr",zIndex:2147483647}),"0"!==n.style.opacity&&(n.style.filter="alpha(opacity=0)"),s.addStyles(this._input,{position:"absolute",right:0,left:0,margin:0,padding:0,fontSize:"480px",fontFamily:"sans-serif",cursor:"pointer",height:"100%",width:"100%",zIndex:11}),this._input.turnOff=s.addEvent(this._input,"change",function(){e._input&&""!==e._input.value&&!1!==e._addFiles(t?e._input.files:e._input)&&(s.removeClass(e._overBtn,e._opts.hoverClass),s.removeClass(e._overBtn,e._opts.focusClass),e._killInput(),e._createInput(),e._opts.autoSubmit&&e.submit())}),""!==e._opts.hoverClass&&(n.mouseOverOff=s.addEvent(n,"mouseover",function(){s.addClass(e._overBtn,e._opts.hoverClass)})),n.mouseOutOff=s.addEvent(n,"mouseout",function(){e._input.parentNode.style.visibility="hidden",""!==e._opts.hoverClass&&(s.removeClass(e._overBtn,e._opts.hoverClass),s.removeClass(e._overBtn,e._opts.focusClass))}),""!==e._opts.focusClass&&(this._input.focusOff=s.addEvent(this._input,"focus",function(){s.addClass(e._overBtn,e._opts.focusClass)}),this._input.blurOff=s.addEvent(this._input,"blur",function(){s.removeClass(e._overBtn,e._opts.focusClass)})),n.appendChild(this._input),e._btns[0].appendChild(n),n=null},_last:function(e,t,n,i,o){"use strict";if(e&&(e.innerHTML=""),n&&(n.innerHTML=""),i&&o&&s.remove(i),t&&s.remove(t),this._active--,e=t=n=i=o=null,this._disabled&&this.enable(!0),this._destroy&&0===this._queue.length&&0===this._active)for(var r in this)this.hasOwnProperty(r)&&delete this[r];else this._cycleQueue()},_errorFinish:function(e,t,s,n,i,o,r,a,l,u){"use strict";this.log("Upload failed: "+t+" "+s),this._opts.onError.call(this,e.name,i,t,s,n,e.btn,e.size),this._last(r,o,a,l,u),e=t=s=n=i=r=o=a=l=u=null},_finish:function(e,t,n,i,o,r,a,l,u){"use strict";this.log("Server response: "+i),"json"!=this._opts.responseType.toLowerCase()||(i=s.parseJSON(i),!1!==i)?(this._opts.onComplete.call(this,e.name,i,e.btn,e.size),this._last(o,r,a,l,u),e=t=n=i=o=r=a=l=u=null):this._errorFinish(e,t,n,!1,"parseerror",r,o,l,u)},_checkFile:function(e){"use strict";var t=!1,s=this._opts.allowedExtensions.length;if(s>0){for(;s--;)if(this._opts.allowedExtensions[s].toLowerCase()==e.ext.toLowerCase()){t=!0;break}if(!t)return this.removeCurrent(e.id),this.log("File extension not permitted"),this._opts.onExtError.call(this,e.name,e.ext),!1}return e.size&&!1!==this._opts.maxSize&&e.size>this._opts.maxSize?(this.removeCurrent(e.id),this.log(e.name+" exceeds "+this._opts.maxSize+"K limit"),this._opts.onSizeError.call(this,e.name,e.size),!1):(e=null,!0)},_killInput:function(){"use strict";this._input&&(this._input.turnOff&&this._input.turnOff(),this._input.focusOff&&this._input.focusOff(),this._input.blurOff&&this._input.blurOff(),this._input.parentNode.mouseOverOff&&this._input.parentNode.mouseOverOff(),s.remove(this._input.parentNode),delete this._input,this._input=null)},_cycleQueue:function(){"use strict";this._queue.length>0&&this._opts.autoSubmit&&this.submit(void 0,!0)},_validateForm:function(){"use strict";return!(this._form.checkValidity&&!this._form.checkValidity())}}),t?s.extendObj(s.SimpleUpload.prototype,s.XhrUpload):s.extendObj(s.SimpleUpload.prototype,s.IframeUpload),s.extendObj(s.SimpleUpload.prototype,s.DragAndDrop),s}),function(){function e(e){if(e&&e.currentTarget){var t=e.currentTarget;t.onceAfter("rendered",function(){if(t.titleTextEl&&"Add Form Field"===t.titleTextEl.get("textContent")){var e=t.fields.fieldOptions,s=e.get("options");"file"!==s[0].icon&&(s.unshift({icon:"file",title:"Upload Files",value:{description:"FileField;MaxSize=5120;Multiple;addText=Add_your_Files;",placeholder:".jpg, .jpeg, .png, .gif, .txt",type:"textarea",title:"Upload Files",id:null,required:!1,textarea:!0}}),e.set("options",s))}if("editor-block-form"===t.getName()){var n=t.getField("fields");n.after("dataChange",function(){n.get("contentBox").all(".sqs-form-builder-field").each(function(e){e.one('textarea[placeholder="Description"]')&&e.one('textarea[placeholder="Description"]').get("innerText").indexOf("FileField;")>-1&&e.addClass("icon-file")})})}})}}function t(e){try{var t=Static&&Static.SQUARESPACE_CONTEXT,s={pluginName:"Uploader",pluginPage:t&&t.website.baseUrl?t.website.baseUrl+location.pathname:location.href,pageTitle:document.title,pluginData:e||"No plugin data",siteTitle:t&&t.website.siteTitle||"",siteUrl:t&&t.website.baseUrl||location.origin},n=new XMLHttpRequest;n.open("POST","https://tools.squarewebsites.org/api/sqs-plugins",!0),n.setRequestHeader("Content-Type","application/json;charset=UTF-8"),n.send(JSON.stringify(s))}catch(e){console.log(e)}}function s(e,t,s,n){if(!t.querySelector("#"+s)){var i=document.createElement("link");i.href=e,i.rel="stylesheet",i.id=s||(new Date).getTime(),i.onload=function(){n&&n(null,{nodes:[this]})},t=t||document.getElementsByTagName("head")[0],t.appendChild(i)}}function n(){Y.Global.after("EditingDialog:show",e),s("https://uploader.squarewebsites.org/assets/css/site-style.css",window.top.document.getElementsByTagName("head")[0],"uploaderTopStyles"),r&&(window.clearInterval(r),r=null)}window.SQSFormUpload=function(){function e(){var e=Array.prototype.slice.call(document.querySelectorAll(".form-wrapper:not(.hidden)"));s(e)}function s(e){if(e.length)for(var t=0;t<e.length;t++){var s=i(e[t]);s.length&&s.forEach(function(e,t){n(e,t)})}}function n(e){if(e.className.indexOf("sqsf-uploader")<0){var s=e.getAttribute("id");e.querySelector(".description")&&(e.querySelector(".description").style.display="none");var n=e.querySelector(".description")?e.querySelector(".description").textContent.replace(/ /g,""):"",i=e.querySelector(".field-element"),o=i.getAttribute("placeholder")?i.getAttribute("placeholder").replace(/ /g,"").split(","):[".jpg",".jpeg",".png",".gif",".txt"];if(i&&(i.style.display="none"),i&&"TEXTAREA"!==i.tagName){i.style.display="none";var r=document.createElement("textarea");r.id=i.id,r.style.display="none",r.className=i.className,r.value=i.value.replace(/   /g,"   \n"),e.removeChild(i),i=r,e.appendChild(i)}var a,l=1024,u="Add_Files",d="https://uploader.squarewebsites.org/api/upload/",c="https://uploader.squarewebsites.org/api/upload-progress/";if(n&&n.indexOf("Multiple")>-1&&(a=!0),n&&n.indexOf("MaxSize")>-1){var p=parseFloat(n.split("MaxSize")[1].split("=")[1].split(";")[0]);l=p||l}n&&n.indexOf("UploadUrl")>-1&&(d=n.split("UploadUrl")[1].split("=")[1].split(";")[0]),n&&n.indexOf("addText")>-1&&(u=n.split("addText")[1].split("=")[1].split(";")[0]),n&&n.indexOf("UploadProgressUrl")>-1&&(c=n.split("UploadProgressUrl")[1].split("=")[1].split(";")[0]);var f=!1;n.indexOf("capture")>-1&&(f=!0),u=u.replace(/_/g," "),s&&window.sqsf_uploaders[s]&&(window.sqsf_uploaders[s].destroy(),window.sqsf_uploaders[s]=null);var h=e.querySelector(".fileInput");if(h){for(;h.firstChild;)h.removeChild(h.firstChild);e.removeChild(h)}var m=document.createElement("div");m.innerHTML='<div style="margin-right: 15px;" class="uploadButton button sqs-system-button sqs-editable-button sqs-button-element--primary">'+u+'</div><div class="progressBox"></div><div class="messageBox"></div>',m.className="fileInput field-element clear",m.style="background: none;border: none;padding-left: 0;";var _=document.createElement("div");_.className="field-error",e.appendChild(m);var g=e.querySelectorAll(".messageBox")[0],v="";try{v=window.Static.SQUARESPACE_CONTEXT.website.internalUrl}catch(e){console.warn("no internal found")}var y=new ss.SimpleUpload({customHeaders:{ssurl:v},id:s,accept:o.toString(),multiple:a,button:e.querySelector(".uploadButton"),dropzone:e.querySelector(".uploadButton"),url:d,capture:f,name:"uploadfile",sessionProgressUrl:c,responseType:"json",allowedExtensions:o.map(function(e){return e.replace(/\./g,"").replace(/ /g,"")}),maxSize:l,hoverClass:"ui-state-hover",focusClass:"ui-state-focus",disabledClass:"ui-state-disabled",onChange:function(){e.querySelector(".field-error")&&e.removeChild(e.querySelector(".field-error"))},onExtError:function(t,s){_.innerHTML="Your file "+t+' is "'+s+'" type. We accept only these files '+o,e.insertBefore(_,e.querySelector(".title"))},onSizeError:function(t,s){_.innerHTML="Your file "+t+" is "+s+"KB size. We accept only files < "+this._opts.maxSize+"KB",e.insertBefore(_,e.querySelector(".title"))},onBlankSubmit:function(e){},onSubmit:function(t,s,n,i){e.querySelector(".field-error")&&e.removeChild(e.querySelector(".field-error"));var o=document.createElement("div"),r=document.createElement("div"),l=document.createElement("div"),u=e.querySelector(".progressBox");if(o.className="progress",o.style="width:100%; height: 4px;margin: 5px 0;",r.className="progress-bar",r.style="background: #a5a5a5;height: 100%;transition: width 1s 0.1s ease;",l.className="wrapper",!a){var d=Array.prototype.slice.call(e.querySelectorAll(".wrapper"));d.forEach(function(e){e.parentNode.removeChild(e)})}o.appendChild(r),l.innerHTML='<div class="name" style="margin:10px 10px 10px 0">'+t+" <span> - "+i+"KB</span></div>",l.appendChild(o),u.appendChild(l),this.setProgressBar(r),this.setProgressContainer(l)},onComplete:function(t,s){if(!s)return _.textContent=t+" upload failed",e.insertBefore(_,e.querySelector(".title")),console.warn(t+" upload failed"),!1;if(s.success){i.value=i.value+"   \n"+s.fileUrl;var n=document.createElement("div");n.className="upload-success",n.innerHTML='<div class="name" style="margin:10px 10px 10px 0;color: green;">'+t+" <span> - "+(s.size/1e3).toFixed(2)+"KB</span></div>",g.appendChild(n)}else{_.innerHTML=s.msg,e.insertBefore(_,e.querySelector(".title"));var o=Array.prototype.slice.call(e.querySelectorAll(".wrapper"));o.forEach(function(e){e.parentNode.removeChild(e)}),console.warn("Upload failed. "+s.msg)}}});if(e.className=e.className+" sqsf-uploader",s&&(window.sqsf_uploaders[s]=y),i.value&&i.value.indexOf("https://")>-1){var b=i.value.trim().split("   \n").length,x=b>1?"s":"",C=document.createElement("div");C.className="upload-success",C.innerHTML='<div class="name" style="margin:10px 10px 10px 0;color: green;">'+b+" <span>file"+x+" already added.</span></div>",g.appendChild(C)}t()}}function i(e){var t=[];return Array.prototype.slice.call(e.querySelectorAll(".form-item")).forEach(function(e){var s=e.querySelector(".description");s&&s.textContent.indexOf("FileField")>-1&&t.push(e)}),t}return e(),{sync:function(){e()},checkForms:function(e){s(e)}}},window.sqsf_uploaders={};var i=null,o=!1,r=!1,a=function(){window.Squarespace.onInitialize(Y,function(){window.SQSFormUpload&&!i&&(i=window.SQSFormUpload()),window.sqsformuploader_observer||(window.sqsformuploader_observer=new MutationObserver(function(e){e.forEach(function(e){"childList"==e.type&&e.addedNodes[0]&&e.addedNodes[0].className&&e.addedNodes[0].className.length&&e.addedNodes[0].querySelector("form")&&i&&i.checkForms([e.addedNodes[0]])})}),window.sqsformuploader_observer.observe(document,{attributes:!0,childList:!0,subtree:!0})),o&&i&&i.checkForms(Array.prototype.slice.call(document.querySelectorAll(".form-wrapper:not(.hidden)"))),o=!0,window.self!==window.top&&window.top.document.querySelector("html.squarespace-damask")&&n()}),window.Squarespace.onDestroy(Y,function(){for(var e in window.sqsf_uploaders)e&&window.sqsf_uploaders.hasOwnProperty(e)&&window.sqsf_uploaders[e].destroy&&window.sqsf_uploaders[e].destroy();window.sqsf_uploaders={}})};window.Y?a():document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,!1),setTimeout(function(){a()},16)},!1)}();